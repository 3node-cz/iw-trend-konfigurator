(function(a,p){typeof exports=="object"&&typeof module<"u"?p(require("react"),require("react-dom")):typeof define=="function"&&define.amd?define(["react","react-dom"],p):(a=typeof globalThis<"u"?globalThis:a||self,p(a.React,a.ReactDOM))})(this,(function(a,p){"use strict";var x={},j;function S(){if(j)return x;j=1;var r=p;return x.createRoot=r.createRoot,x.hydrateRoot=r.hydrateRoot,x}var b=S(),g={exports:{}},y={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var C;function w(){if(C)return y;C=1;var r=a,l=Symbol.for("react.element"),o=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,v={key:!0,ref:!0,__self:!0,__source:!0};function h(d,t,n){var i,f={},m=null,u=null;n!==void 0&&(m=""+n),t.key!==void 0&&(m=""+t.key),t.ref!==void 0&&(u=t.ref);for(i in t)c.call(t,i)&&!v.hasOwnProperty(i)&&(f[i]=t[i]);if(d&&d.defaultProps)for(i in t=d.defaultProps,t)f[i]===void 0&&(f[i]=t[i]);return{$$typeof:l,type:d,key:m,ref:u,props:f,_owner:s.current}}return y.Fragment=o,y.jsx=h,y.jsxs=h,y}var N;function O(){return N||(N=1,g.exports=w()),g.exports}var e=O();const E=({customer:r,shop:l,settings:o,blockId:c})=>{var f,m;const[s,v]=a.useState(((f=r==null?void 0:r.metafields)==null?void 0:f.saved_configurations)||""),[h,d]=a.useState(!1),[t,n]=a.useState(null),i=a.useCallback(async()=>{if(!r){n({type:"error",text:"Please login to save configurations"});return}try{s.trim()&&JSON.parse(s)}catch{n({type:"error",text:"Invalid JSON format. Please check your data."});return}d(!0),n(null);try{const R=await(await fetch("/apps/configurator/api/update-metafield",{method:"POST",headers:{"Content-Type":"application/json","X-Shopify-Shop-Domain":l.domain},body:JSON.stringify({customer_id:r.id,namespace:"custom",key:"saved_configurations",value:s,type:"multi_line_text_field"})})).json();R.success?(n({type:"success",text:"Configuration updated successfully!"}),setTimeout(()=>{window.location.reload()},1500)):n({type:"error",text:R.error||"Failed to update configuration"})}catch{n({type:"error",text:"Network error. Please try again."})}finally{d(!1)}},[r,l.domain,s]);return e.jsxs("div",{className:"configurator-widget",style:{"--primary-color":o.primaryColor},children:[e.jsxs("div",{className:"configurator-header",children:[e.jsx("h3",{style:{color:o.primaryColor},children:o.title}),o.description&&e.jsx("p",{className:"configurator-description",children:o.description})]}),e.jsx("div",{className:"customer-info-section",children:r?e.jsxs("div",{className:"customer-welcome",children:[e.jsxs("h4",{style:{color:o.primaryColor},children:["Welcome back, ",r.firstName||r.email,"! ðŸ‘‹"]}),o.showCustomerDetails&&e.jsx("div",{className:"customer-details",children:(r.firstName||r.lastName)&&e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",r.firstName," ",r.lastName]})}),o.showMetafields&&e.jsxs("div",{className:"customer-metafields",children:[e.jsx("h5",{children:"Your Saved Configurations:"}),e.jsx("div",{className:"metafields-grid",children:(m=r.metafields)!=null&&m.saved_configurations?e.jsxs("div",{className:"metafield-item",children:[e.jsx("span",{className:"metafield-label",children:"Configurations:"}),e.jsxs("span",{className:"metafield-value",style:{color:o.primaryColor},children:[r.metafields.saved_configurations.substring(0,100),"..."]})]}):e.jsx("p",{className:"no-metafields",children:"No saved configurations yet. Create your first configuration below!"})})]})]}):e.jsx("div",{className:"customer-login-prompt",style:{borderLeftColor:o.primaryColor},children:e.jsxs("p",{children:["ðŸ‘¤ ",e.jsx("a",{href:"/account/login",style:{color:o.primaryColor},children:"Login"})," or"," ",e.jsx("a",{href:"/account/register",style:{color:o.primaryColor},children:"create an account"})," to save your preferences and see personalized recommendations."]})})}),r&&e.jsxs("div",{className:"configurator-form",children:[e.jsx("h5",{children:"Edit Your Configuration Data:"}),e.jsxs("div",{className:"configurator-option",children:[e.jsx("label",{htmlFor:`configurator-metafield-${c}`,children:"Saved Configurations (JSON):"}),e.jsx("textarea",{id:`configurator-metafield-${c}`,name:"saved_configurations",rows:8,className:"configurator-textarea",placeholder:"Enter your configuration data in JSON format...",value:s,onChange:u=>v(u.target.value)}),e.jsx("small",{style:{color:"#666"},children:"Edit the JSON data above directly. Make sure to keep valid JSON format."})]}),e.jsx("div",{className:"configurator-actions",children:e.jsx("button",{type:"button",className:"configurator-submit-btn",style:{backgroundColor:o.primaryColor},onClick:i,disabled:h,children:h?"Updating...":"Update Configuration Data"})}),t&&e.jsx("div",{className:`configurator-message ${t.type}`,style:{borderColor:t.type==="success"?o.primaryColor:"#dc3545",color:t.type==="success"?o.primaryColor:"#dc3545"},children:t.text})]})]})};function _(){Object.keys(window.ConfiguratorConfig||{}).forEach(r=>{const l=window.ConfiguratorConfig[r],o=document.getElementById(`react-root-${r}`),c=document.getElementById(`loading-${r}`);o&&l&&(c&&(c.style.display="none"),o.style.display="block",b.createRoot(o).render(a.createElement(E,l)))})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",_):_()}));
